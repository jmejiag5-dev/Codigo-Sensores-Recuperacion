#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_ADDR 0x3C

#define TILT 2
#define LASER 7

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

// ====== MARCO FUTURISTA ======
void marcoHUD() {
  display.drawRect(0, 0, 128, 64, WHITE);
  display.drawLine(0, 0, 15, 0, WHITE);
  display.drawLine(0, 0, 0, 15, WHITE);

  display.drawLine(113, 0, 127, 0, WHITE);
  display.drawLine(127, 0, 127, 15, WHITE);

  display.drawLine(0, 49, 0, 63, WHITE);
  display.drawLine(0, 63, 15, 63, WHITE);

  display.drawLine(127, 49, 127, 63, WHITE);
  display.drawLine(113, 63, 127, 63, WHITE);
}

// ====== SWITCH ======
void iconoSwitch(bool estado) {
  display.drawRoundRect(10, 22, 40, 18, 8, WHITE);
  if (estado) {
    display.fillCircle(38, 31, 7, WHITE);
  } else {
    display.fillCircle(22, 31, 7, WHITE);
  }
}

// ====== EMISOR LASER ======
void iconoLaser(bool activo) {

  display.drawRect(85, 22, 25, 12, WHITE);
  display.drawRect(110, 25, 6, 6, WHITE);

  if (activo) {
    display.drawLine(50, 28, 85, 28, WHITE);
    display.drawLine(50, 30, 85, 30, WHITE);
  }
}

// ====== INTERFAZ PRINCIPAL ======
void pantallaHUD(bool alerta) {

  display.clearDisplay();

  marcoHUD();

  display.setTextSize(1);
  display.setCursor(22, 4);
  display.print("LASER SECURITY HUD");

  display.drawLine(10, 14, 118, 14, WHITE);

  iconoSwitch(alerta);
  iconoLaser(alerta);

  display.setCursor(10, 45);

  if (alerta) {
    display.print("TILT: TRIGGERED");
  } else {
    display.print("TILT: STABLE");
  }

  display.drawRect(20, 55, 88, 4, WHITE);
  if (alerta) {
    display.fillRect(22, 56, 84, 2, WHITE);
  }

  display.display();
}

void setup() {

  pinMode(TILT, INPUT_PULLUP);  // MÃ¡s estable
  pinMode(LASER, OUTPUT);

  if (!display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDR)) {
    while (true);
  }
}

void loop() {

  bool alerta = digitalRead(TILT) == LOW;

  if (alerta) {
    digitalWrite(LASER, HIGH);   // ðŸ”´ LÃ¡ser encendido fijo
  } else {
    digitalWrite(LASER, LOW);    // âš« LÃ¡ser apagado
  }

  pantallaHUD(alerta);
}
